<html>
    <head>
        <title>TeaScript Interpreter</title>
        <script src="http://babeljs.io/scripts/babel.js"></script>
        <style>
            *:not(code) {
                font-family: sans-serif;
                color: black;
            }
        </style>

    </head>

    <body>
        <h2>TeaScript Interpreter</h2>
        <sub>JavaScript, but shorter (or not).</sub>
        <hr>
        <a href="index2.html">Nicer WIP Interpreter</a>
        <p>Do note, some built-ins may not transpiled, you're safer off using a browser such as Firefox to avoid any such problems. This interpreter is a "rough draft" a nicer one is being developed at the moment. All code is being executed client side with help from Babel libraries to being ES6/7 features to every browser.</p>
        <hr>
        <textarea placeholder="Code..." id="code" style="width:750px; height:200px; font-size: 14px; font-family: monospace;"><?=$_GET['code']?></textarea>

        <textarea placeholder="Input..." id="input"><?=$_GET['input']?></textarea>
        <textarea placeholder="Input 2..." id="input2"></textarea>
        <textarea placeholder="Input 3..." id="input3"></textarea>
        <button id="go">Run</button>
        <hr>
        <pre id="out">Output...</pre><button id="link">Generate Permalink</button>
        <hr>
        Function declerations such as <code>.map((item, index, array)=>/*code*/)</code> can be shortened to <code>.map(#/*code*/)</code>. <code>(#</code> expands to: <code>((l,i,a)=></code>
        <hr>
        <h2>Cheatsheet &amp; Learning TeaScript</h2>
        <p>TeaScript is an easy language to learn, you can think of it as JavaScript with shortened property named. A few other functions are also added such as directly reversing strings, mapping over strings, global replacments, and more!</p>
        <p>TeaScript is pretty simple. The input is stored in the variable <code>x</code>. TeaScript also implicitly returns the last evalulated statement, what does this mean? It just means you don't have to do anything, you just write your code, and it will return it's value.</p>
        <p>TeaScript is JavaScript, to get started. You can just write plain JavaScript and it will work! TeaScript runs ES7 JavaScript meaning even on a regular ol' browser, you can use features such as "fat-arrow" functions and "Array comprehensions"</p>
        <p>If TeaScript is JavaScript with x as the input, then what's special about TeaScript? TeaScript is JavaScript for golfing so function names are abbreviated to (usually) one-letter. So .slice could become <code>S</code> and .toString could become <code>T</code>. You can see the full list of these abbreviations below</p>
        <p>Now besides <i>much</i> shorter variable names, what else? They're a few features which use special semantics to aid in golfing. One example is in fat-arrow functions. You may normally write <code>((l,i,a)=></code> but now writing <code>#</code> will expand to <code>((l,i,a)=></code> exactly.</p>
        <p>Another feature <a href="http://codegolf.stackexchange.com/questions/61666/have-you-learned-your-fib-abc/61669?noredirect=1#comment148665_61669">suggested</a> by StackExchange user <a href="http://codegolf.stackexchange.com/users/42545/ethproductions">@ETHproductions</a> allows the reduction of periods. Variables <code>x, l, i, and a</code> when immediately followed by another letter, have a period inserted between them. Periods are also not needed after parenthesis, e.g. <code>xS(1,3)R(3)</code> is equal to: <code>x.S(1,3).R(3)</code> which is the same as <code>x.slice(1,3).repeat(3)</code></p>

        <br>
        <a href="teascript.js">Source Code Here</a>. You can also submit bugs, and other updates to <a href="mailto:vihan1086@gmail.com">vihan1086@gmail.com</a> or through <a href="http://codegolf.stackexchange.com/users/40695/vɪʜᴀɴ">StackExchange</a>

        <pre id="cheat">x is the input<br></pre>

        <script>
            // Uses babel.js to transcompile ES7 to ES5

            Array.range = function range (n, m) {
                return Array((m||n+n)-n).join().split(',').map(function (_, i) {
                    return (m ? n : 0) + i;
                });
            };

            Array.prototype.cycle = function cycle (int) {
                return this.slice(-int) + this.slice(0, -int);
            };

            String.prototype.g_replace = function g_replace (a,b, flag) {
                return this.replace( new RegExp(a, 'g' + (flag || '')), b )
            };

            String.prototype.reverse = function reverse () {
                return this.split('').reverse().join('');
            };

            String.prototype.batchReplace = function batchReplace (form) {
                return form.match(/../g).reduce(function (old, format) {
                    return old.replace( new RegExp('\\'+format[0], 'g'), format[1] );
                }, this);
            };

            String.prototype.loop = function loop (func, delimiter) {
                return this.split(delimiter || '').map(func).join(delimiter || '');
            };

            String.prototype.reduce = function reduce (func, start) {
                return this.split('').reduce(func, start || this)
            };

            String.prototype.head = function head (int) {
                return this.slice(0, int);
            };

            String.prototype.cycle = function cycle (int) {
                return this.slice(-int) + this.slice(0, -int);
            };

            Math.Fib = function Fib (n) {
                if (n <= 1)
                    return n;
                return Math.Fib(n-1) + Math.Fib(n-2);
            }

            Math.prime = function prime (number) {
                var start = 2;
                while (start <= Math.sqrt(number)) {
                    if (number % start++ < 1) return false;
                }
                return number > 1;
            }

            function addItem (a,b) {
                document.getElementById('cheat').innerHTML += a+" -> "+b+"<br>";
            }

            var rules = {
                "Math": {
                    'p': 'pow',
                    'P': 'prime',
                    'h': 'hypot',
                    's': 'sqrt',
                    'a': 'abs',
                    'r': 'random',
                    'F': 'Fib'
                },
                "String": {
                    'c': 'fromCharCode'
                },
                "Array": {
                    'r': 'range'
                }
            }, proto = {
                "String": {
                    'B': 'batchReplace',
                    'c': 'charCodeAt',
                    'C': 'cycle',
                    'd': 'reduce',
                    'g': 'g_replace',
                    'h': 'head',
                    'i': 'indexOf',
                    'L': 'toLowerCase',
                    'l': 'loop',
                    'm': 'match',
                    'r': 'replace',
                    'R': 'repeat',
                    's': 'split',
                    'S': 'slice',
                    'u': 'toUpperCase',
                    'v': 'reverse',
                },
                "Array": {
                    'C': 'cycle',
                    'f': 'fill',
                    'j': 'join',
                    'k': 'keys',
                    'm': 'map',
                    'r': 'reverse',
                    'R': 'reduce'
                },
                "Number": {
                    'b': 'toString'
                },
                "RegExp": {
                    't': 'test'
                }
            }, enviorment = {
                '$': 'Math',
                'S': 'String',
                'A': 'Array',
                'e': 'eval',
                'R': 'RegExp',
                'D': 'Date'
            }, noinf = {
                'C': String.fromCharCode,
                'F': Math.Fib,
                'a': Math.abs,
                'r': Array.range
            };

            Object.keys(rules).forEach(function (global) {
                Object.keys(rules[global]).forEach(function (prop) {
                    window[global][prop] = window[global][ rules[global][prop] ];
                    addItem(global+'.'+prop, global + '.' + rules[global][prop]);
                });
            });

            Object.keys(proto).forEach(function (global) {
                Object.keys(proto[global]).forEach(function (prop) {
                    window[global].prototype[prop] = window[global].prototype[ proto[global][prop] ]
                    addItem(global + '.prototope.' + prop, global + '.prototype.' + proto[global][prop]);
                });
            });

            Object.keys(enviorment).forEach(function (global) {
                window[global] = window[enviorment[global]];
                addItem(global, enviorment[global]);
            });

            Object.keys(noinf).forEach(function (global) {
                if (!window[global])
                    window[global] = noinf[global];
                else
                    console.warn("Could not map " + global);
                addItem(global, noinf[global].name);
            });

            var TeaScript = function (code, input) {

                var c=d=f=g=h=i=j=k=l=m=n=o=p=q=s=t=u=v=w=0;
                var b = "";

                window['_'] = input;
                window['x'] = +input[0] || input[0];
                window['y'] = +input[1] || input[1];
                window['z'] = +input[2] || input[2];

                var b = babel.transform(code
                                        .replace(/\(#/g,'((l,i,a)=>')
                                        .replace(/\(([^)#]+?)#(\d|[A-Za-z])/g,'($1)[$2]')
                                        .replace(/([xlia)])([A-Za-z])\(/g,'$1.$2(')
                                       ).code;
                console.log(b);
                return eval(b);
            };

        </script>

        <script>
            document.getElementById('link').onclick = function () {
                window.location.href = 'http://vihanserver.tk/p/TeaScript/?code='+encodeURIComponent(document.getElementById('code').value)+'&input='+encodeURIComponent(document.getElementById('input').value);
            };
            document.getElementById('go').onclick = function () {
                document.getElementById('out').innerHTML = TeaScript(
                    document.getElementById('code').value,
                    [document.getElementById('input').value
                    document.getElementById('input2').value,
                    document.getElementById('input3').value]
                );
            };
        </script>

    </body>

</html>